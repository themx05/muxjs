(()=>{"use strict";var e=function(){return e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},e.apply(this,arguments)},t=function(){function t(e){Object.defineProperty(this,"event",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"expression",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.event=e}return Object.defineProperty(t.prototype,"channel",{get:function(){var e;return null===(e=this.event.data)||void 0===e?void 0:e._channel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"match",{get:function(){if(this.expression){var e=this.channel.match("string"==typeof this.expression?(t=this.expression,n=t,[["/","/"],[".","."],[",",","],["(","("],[")",")"],["[","["],["]","]"],["**",".*"]].forEach((function(e){n=n.replaceAll(e[0],e[1])})),n=n.replaceAll(/:(?<hold>[_a-zA-Z]{1,}[a-zA-Z0-9]*)/g,(function(e){for(var t,n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var i=/:(?<hold>[_a-zA-Z]{1,}[a-zA-Z0-9]*)/g.exec(e);return i&&i.groups&&(null===(t=i.groups)||void 0===t?void 0:t.hold)?"(?<".concat(null===(n=i.groups)||void 0===n?void 0:n.hold,">.*)"):e})),new RegExp("^".concat(n,"$"),"gm")):this.expression);return e}var t,n;return null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"params",{get:function(){var t;return e({},null===(t=this.match)||void 0===t?void 0:t.groups)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"data",{get:function(){var e;return null===(e=this.event.data)||void 0===e?void 0:e._payload},enumerable:!1,configurable:!0}),t}(),n=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function u(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,u)}l((r=r.apply(e,t||[])).next())}))},r=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};!function(){function e(){Object.defineProperty(this,"_channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._channel=new MessageChannel,globalThis.window&&(this._channel.port1.start(),this._channel.port2.start())}Object.defineProperty(e.prototype,"_input",{get:function(){return this._channel.port1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_output",{get:function(){return this._channel.port2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dispatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){e&&this._input.postMessage({_channel:e,_payload:t})}}),Object.defineProperty(e.prototype,"subscribeOnly",{enumerable:!1,configurable:!0,writable:!0,value:function(e,o){var i=this,a=function(a){return n(i,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return(null===(i=a.data)||void 0===i?void 0:i._channel)?(n=new t(a)).channel!==e?[3,2]:[4,o(n)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))};return this._output.addEventListener("message",a),function(){i._output.removeEventListener("message",a)}}}),Object.defineProperty(e.prototype,"subscribeMultiple",{enumerable:!1,configurable:!0,writable:!0,value:function(e,o){var i=this,a=function(a){return n(i,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return(null===(i=a.data)||void 0===i?void 0:i._channel)?(n=new t(a),e.includes(n.channel)?[4,o(n)]:[3,2]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))};return this._output.addEventListener("message",a),function(){i._output.removeEventListener("message",a)}}}),Object.defineProperty(e.prototype,"subscribeMatch",{enumerable:!1,configurable:!0,writable:!0,value:function(e,o){var i=this,a=function(a){return n(i,void 0,void 0,(function(){var n,i;return r(this,(function(r){switch(r.label){case 0:return(null===(i=a.data)||void 0===i?void 0:i._channel)?((n=new t(a)).expression=e,n.match?[4,o(n)]:[3,2]):[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))};return this._output.addEventListener("message",a),function(){i._output.removeEventListener("message",a)}}})}()})();